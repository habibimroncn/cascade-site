!function(e){e.fn.glossary=function(t,i){var a={ignorecase:!1,tiptag:"h6",excludetags:[],linktarget:"_blank",showonce:!1},i=e.extend(a,i),n=1;return this.each(function(a,o){e.each(i.excludetags,function(e,t){i.excludetags[e]=t.toUpperCase()});var r=function(t,a,o,s){var l=a,d=0;if(3==t.nodeType){if(i.ignorecase)var c=t.data.toLowerCase().indexOf(l.toLowerCase());else var c=t.data.indexOf(l);if(c>=0)if(jQuery.inArray(e(t).parent().get(0).tagName,i.excludetags)>-1);else{var p=document.createElement("a");p.className="glossaryTerm","0"==o?(p.id="glossaryID"+n,p.href="#",p.title="Click for '"+a+"' definition",p.className="glossaryTerm",e(p).click(function(t){return e.glossaryTip("<"+i.tiptag+">"+a+"</"+i.tiptag+"><p>"+s+"</p>",{mouse_event:t}),!1})):"1"==o?(p.title="Click to look up '"+a+"' in Wikipedia",a=a.replace(/ /g,"_"),p.href="http://en.wikipedia.org/wiki/"+a,p.target=i.linktarget):"2"==o?(p.title="Click to search for '"+a+"' in Google",a=a.replace(/ /g,"+"),p.href="http://www.google.co.uk/search?q="+a,p.target=i.linktarget):"3"==o&&(p.title="Click to view '"+a+"' definition",p.href=s,p.target=i.linktarget);var g=t.splitText(c),h=(g.splitText(l.length),g.cloneNode(!0));h.data=h.data.toUpperCase(),p.appendChild(h),g.parentNode.replaceChild(p,g),d=1,n+=1}}else if(1==t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&-1===t.className.split(" ").indexOf("noterms"))for(var f=0;f<t.childNodes.length;++f){var u=r(t.childNodes[f],a,o,s);i.showonce&&1==u?(f=t.childNodes.length,d=1):f+=u}return d};e.ajax({type:"GET",url:t,dataType:"json",success:function(e){if(e)for(var t=e.length,i=0;t>i;i++){var a=e[i];r(o,a.term,a.type,a.definition)}},error:function(){}})})};var t=function(){};e.extend(t.prototype,{setup:function(){e("#glossaryTip").length&&e("#glossaryTip").remove(),t.holder=e('<div id="glossaryTip" style="max-width:260px;"><div id="glossaryClose"></div></div>'),t.content=e('<div id="glossaryContent"></div>'),e("body").append(t.holder.append(t.content))},show:function(e,i){t.content.html(e);var a=parseInt(i.mouse_event.pageX)+15,n=parseInt(i.mouse_event.pageY)+5;t.holder.css({top:n,left:a}),t.holder.is(":hidden")&&t.holder.show(),t.holder.bind("click",function(){return t.holder.stop(!0).fadeOut(200),!1})}}),e.glossaryTip=function(i,a){var n=e.glossaryTip.instance;return n||(n=e.glossaryTip.instance=new t),n.setup(),n.show(i,a),n}}(jQuery);